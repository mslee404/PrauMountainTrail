$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
name: auto_deploy_best_model
display_name: Auto Deploy Best Model
version: 1
type: command

inputs:
  input_data: 
    type: uri_folder 
    description: "Folder output dari training yang berisi metrics.json"
  endpoint_name: 
    type: string
    default: "track-training-endpoint"
  model_name:
    type: string
    default: "track-clustering-model"
  min_accuracy:
    type: number
    default: 0.8
    description: "Minimum Silhouette Score to allow deployment"
  compute_name:
    type: string
    default: "compute-cluster1"
    description: "Nama compute target untuk deployment"
  input_model_signal:
    type: uri_folder
    optional: true

code: ./deploy_src  # Pastikan file deploy.py ada di folder ini

# Gunakan environment publik Microsoft agar bisa akses library azure-ai-ml
environment: azureml:track-analysis-env:2

command: >-
  python deploy.py 
  --model_name ${{inputs.model_name}} 
  --endpoint_name ${{inputs.endpoint_name}} 
  --input_metrics ${{inputs.input_metrics}} 
  --min_score ${{inputs.min_score}}
  --compute_name ${{inputs.compute_name}}